var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),AssemblyDetailPage=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.typeBaseTemplates={},t.errorsList=[],t.popTemplates={},t.metaType=["Classes","Structures","Interfaces","Enumerations","Delegates"],t.metaSubType=["Methods","Constructors","Properties"],t.assemblyData=[],t}return __extends(t,n),t.prototype.Ready=function(){var i=this,r,t;for(toastr.info("Loading data..."),n.prototype.Ready.call(this),this.popTemplate=$("#poptemplate").html(),this.namespacelistTemplate=Handlebars.compile($("#namespaces-template").html()),this.typeBaseListTemplate=Handlebars.compile($("#typebaselist-template").html()),r=0;r<this.metaType.length;r++)this.typeBaseTemplates[this.metaType[r]]=Handlebars.compile($("#typebase"+this.metaType[r]+"-template").html());for(t=0;t<this.metaSubType.length;t++)this.popTemplates[this.metaSubType[t]+"-Title"]=Handlebars.compile($("#"+this.metaSubType[t]+"-PopTitle-template").html()),this.popTemplates[this.metaSubType[t]+"-Content"]=Handlebars.compile($("#"+this.metaSubType[t]+"-PopContent-template").html());Base.Helpers.AjaxService("POST",this.options.urlGet+"/"+this.options.DllId,null,function(n){n?($("#h2name").text(n.Name),$("#h2sname").text(n.FullName),n.Namespaces.forEach(function(n){n.ClassCount=n.Classes.length;n.StructureCount=n.Structures.length;n.InterfaceCount=n.Interfaces.length;n.EnumerationCount=n.Enumerations.length;n.DelegateCount=n.Delegates.length}),i.assemblyData=n.Namespaces,n=null,i.setNamespaces(i.assemblyData),i.setErrorList(i.assemblyData),i.showErrorsList()):toastr.error("No namespaces","There is no namespaces to parse : Empty DLL")}).done(function(){return toastr.success("Data loaded")}).fail(function(){return toastr.error("Data load failed")})},t.prototype.setErrorList=function(n){var t=this,i=[];n.forEach(function(n){var r,u;for(n.loadError&&i.push(n),r=0;r<t.metaType.length;r++)u=n[t.metaType[r]],u&&u.length>0&&u.forEach(function(n){var r,u;for(n.LoadError&&i.push(n),r=0;r<t.metaSubType.length;r++)u=n[t.metaSubType[r]],u&&u.length>0&&u.forEach(function(n){n.LoadError&&i.push(n)})})});i.forEach(function(n){var r=t.errorsList.map(function(n){return n.message}),i=r.indexOf(n.Fullname);i<0?t.errorsList.push({message:n.Fullname,count:1}):t.errorsList[i].count++});this.errorsList.sort(function(n,t){return n.message>t.message?1:n.message<t.message?-1:0})},t.prototype.showErrorsList=function(){if(this.errorsList.length>0){$("#errorcount").text(this.errorsList.length);$("#errornavmenu").removeClass("hidden").show();var n=Math.min(this.errorsList.length,10),t=Handlebars.compile($("#errorlisttemplate").html());$("#errornavlist").html(t(this.errorsList.splice(0,n-1))).closest("li").removeClass("invisible").addClass("visible")}},t.prototype.setNamespaces=function(n){var i=this,t;$("#nmlist").html(this.namespacelistTemplate(n));t=$("a[data-type]");t.unbind("click").on("click",function(n){i.loadTypeBases($(n.currentTarget))});t.first().trigger("click")},t.prototype.loadTypeBases=function(n){var e=this,f=n.attr("data-id"),t,i,r,u;$("#selected-namespace").text(f);t=this.metaType[parseInt(n.attr("data-type"))];i=this.getNameSpaceData(f);i&&i[t]&&(r=i[t],r?($("#typebasetitle").text(t),r.forEach(function(n){n.namespace=f}),$("#nmsublist").html(this.typeBaseListTemplate(r)),u=$("#nmsublist>.list-group-item"),u.click(function(n){u.removeClass("active");var t=$(n.currentTarget);t.addClass("active");e.loadType(t)}),u.first().trigger("click")):toastr.error("No classes","There is no classes to parse : Empty DLL"))},t.prototype.loadType=function(n){var i=n.attr("data-namespace"),r=$("#typebasetitle").text(),o=n.attr("data-id"),t=this.getTypeBaseClassData(i,o,r),u,f,e;t?(t.namespace=i,u=this.typeBaseTemplates[r],f=u(t),$("#typebase").html(f),e=$("a.popoverselect"),this.setPopOver(e)):toastr.error("No classes","There is no classes to parse : Empty DLL")},t.prototype.setPopOver=function(n){var t=this;n.popover({trigger:"focus",html:!0,title:function(){return t.getPopOverElement($(this),"Title")},content:function(){return t.getPopOverElement($(this),"Content")},container:"body",placement:"left",template:this.popTemplate})},t.prototype.getPopOverElement=function(n,t){var e=n.attr("data-namespace"),i=this.metaSubType[parseInt(n.attr("data-subtype"))],o=this.metaType[parseInt(n.attr("data-type"))],s=n.attr("data-id"),h=n.attr("data-parent"),r=this.getSubTypeBase(e,h,s,o,i),u,f;return r?(u=this.popTemplates[i+"-"+t],f=u(r),f):"Error"},t.prototype.getNameSpaceData=function(n){var t=this.assemblyData.filter(function(t){return t.Name===n});return t&&t.length===1?t[0]:null},t.prototype.getTypeBaseClassData=function(n,t,i){var r=this.getNameSpaceData(n);return r&&r[i]?r[i].filter(function(n){return n.Id===t})[0]:null},t.prototype.getSubTypeBase=function(n,t,i,r,u){var e=this.getTypeBaseClassData(n,t,r),f;return e&&e[u]&&(f=e[u].filter(function(n){return n.Id===i}),f&&f.length===1)?f[0]:null},t}(Base.Page);